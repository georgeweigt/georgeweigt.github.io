\input{preamble}

\section*{Compton scattering}
Compton scattering is the interaction $e^-+\gamma\rightarrow e^-+\gamma$.

\begin{center}
\begin{tikzpicture}
\draw[dashed] (0,0) circle (0.5cm);
\draw[thick,->] (2,0) node[anchor=west] {$e^-$} -- (0.6,0);
\draw[thick,->] (-2,0) node[anchor=east] {$\gamma$} -- (-0.6,0);
\draw[thick,->] (0.40,0.40) -- (1.3,1.3) node[anchor=south west] {$\gamma$};
\draw[thick,->] (-0.4,-0.4) -- (-1.3,-1.3) node[anchor=north east] {$e^-$};
\draw (1,0.5) node {$\theta$};
\end{tikzpicture}
\end{center}

In the center-of-mass frame we have the following momentum vectors
where $\omega$ is incident energy and
$E$ is total energy $E=\sqrt{\omega^2+m^2}$.
Polar angle $\theta$ is the observed scattering angle.
Azimuth angle $\phi$ cancels out in scattering calculations.
\begin{equation*}
p_1=\underset{\substack{\\ \text{inbound}\\ \text{photon}}}
{\begin{pmatrix}\omega\\0\\0\\ \omega\end{pmatrix}},
\quad
p_2=\underset{\substack{\\ \text{inbound}\\ \text{electron}}}
{\begin{pmatrix}E\\0\\0\\-\omega\end{pmatrix}},
\quad
p_3=\underset{\substack{\\ \text{outbound}\\ \text{photon}}}
{\begin{pmatrix}
\omega\\
\omega\sin\theta\cos\phi\\
\omega\sin\theta\sin\phi\\
\omega\cos\theta
\end{pmatrix}},
\quad
p_4=\underset{\substack{\\ \text{outbound}\\ \text{electron}}}
{\begin{pmatrix}
E\\
-\omega\sin\theta\cos\phi\\
-\omega\sin\theta\sin\phi\\
-\omega\cos\theta
\end{pmatrix}}
\end{equation*}

Spinors for the inbound electron.
\begin{equation*}
u_{21}=\frac{1}{\sqrt{E+m}}
\underset{\substack{\\ \text{inbound electron}\\ \text{spin up}}}
{\begin{pmatrix}
E+m\\
0\\
-\omega\\
0
\end{pmatrix}},
\quad
u_{22}=\frac{1}{\sqrt{E+m}}
\underset{\substack{\\ \text{inbound electron}\\ \text{spin down}}}
{\begin{pmatrix}
0\\
E+m\\
0\\
\omega
\end{pmatrix}}
\end{equation*}

Spinors for the outbound electron.
\begin{equation*}
u_{41}=\frac{1}{\sqrt{E+m}}
\underset{\substack{\\ \text{outbound electron}\\ \text{spin up}}}
{\begin{pmatrix}
E+m\\
0\\
p_{4z}\\
p_{4x}+ip_{4y}
\end{pmatrix}},
\quad
u_{42}=\frac{1}{\sqrt{E+m}}
\underset{\substack{\\ \text{outbound electron}\\ \text{spin down}}}
{\begin{pmatrix}
0\\
E+m\\
p_{4x}-ip_{4y}\\
-p_{4z}
\end{pmatrix}}
\end{equation*}

Let $a$ be the spin state of the inbound electron and let $b$
be the spin state of the outbound electron
such that subscript $ba\in\{11,12,21,22\}$.

\bigskip
The probability amplitude $\mathcal M_{ba}$ for spin state $ba$ is
\begin{equation*}
\mathcal M_{ba}=\mathcal M_{1ba}+\mathcal M_{2ba}
\end{equation*}

where
\begin{equation*}
\mathcal M_{1ba}=
\frac{\bar{u}_{4b}(-ie\gamma^\mu)(\slashed{q}_1+m)(-ie\gamma^\nu)u_{2a}}{(p_1+p_2)^2-m^2},
\quad
\mathcal M_{2ba}=
\frac{\bar{u}_{4b}(-ie\gamma^\nu)(\slashed{q}_2+m)(-ie\gamma^\mu)u_{2a}}{(p_1-p_4)^2-m^2}
\end{equation*}

and
\begin{equation*}
\slashed q_1=(p_1+p_2)^\alpha g_{\alpha\beta}\gamma^\beta,
\quad
\slashed q_2=(p_4-p_1)^\alpha g_{\alpha\beta}\gamma^\beta
\end{equation*}

The expected probability $\langle|\mathcal M|^2\rangle$ is the average over all four spin states.
\begin{equation*}
\langle|\mathcal M|^2\rangle=\frac{1}{4}\sum_{a=1}^2\sum_{b=1}^2\mathcal M_{ba}\mathcal M_{ba}^*
\end{equation*}

Hence
\begin{equation*}
\langle|\mathcal{M}|^2\rangle
=\frac{1}{4}\sum_{a=1}^2\sum_{b=1}^2
\left(
\frac{\mathcal M_{1ba}\mathcal M_{1ba}^*}{(s-m^2)^2}
+\frac{\mathcal M_{1ba}\mathcal M_{2ba}^*+\mathcal M_{2ba}\mathcal M_{1ba}^*}{(s-m^2)(u-m^2)}
+\frac{\mathcal M_{2ba}\mathcal M_{2ba}^*}{(u-m^2)^2}
\right)
\end{equation*}

where $s$ and $u$ are the Mandelstam variables
\begin{equation*}
s=(p_1+p_2)^2,\quad u=(p_1-p_4)^2
\end{equation*}

To understand how $\mathcal M_{1ba}\mathcal M_{1ba}^*$ is calculated,
write $\mathcal M_{1ba}$ in component form.
\begin{equation*}
(\mathcal M_{1ba})^{\mu\nu}=\frac{
(\bar{u}_{4b})_\alpha
(-ie\gamma^{\mu\alpha}{}_\beta)
(\slashed{q}_1+m)^\beta{}_\rho
(-ie\gamma^{\nu\rho}{}_\sigma)
(u_{2a})^\sigma}{s-m^2}
\end{equation*}

To sum over $\mu$ and $\nu$ of the product, $g_{\mu\nu}$ is needed to lower indices.
\begin{equation*}
\mathcal M_{1ba}\mathcal M_{1ba}^*=(\mathcal M_{1ba})^{\mu\nu}(\mathcal M_{1ba}^*)_{\mu\nu}
=(\mathcal M_{1ba})^{\mu\nu}g_{\mu\alpha}(\mathcal M_{1ba}^*)^{\alpha\beta}g_{\beta\nu}
\end{equation*}

Similarly for $\mathcal M_{2ba}\mathcal M_{2ba}^*$.
For $\mathcal M_{2ba}$ the index order is $\nu$ followed by $\mu$ hence
\begin{equation*}
\mathcal M_{1ba}\mathcal M_{2ba}^*=(\mathcal M_{1ba})^{\mu\nu}(\mathcal M_{2ba}^*)_{\nu\mu}
=(\mathcal M_{1ba})^{\mu\nu}g_{\nu\beta}(\mathcal M_{2ba}^*)^{\beta\alpha}g_{\alpha\mu}
\end{equation*}

The Casimir trick uses matrix arithmetic to sum over spin states.
\begin{align*}
f_{11}&=\sum_{a=1}^2\sum_{b=1}^2\mathcal M_{1ba}\mathcal M_{1ba}^*=e^4\operatorname{Tr}
\left(
(\slashed{p}_2+m)\gamma^\mu(\slashed{q}_1+m)\gamma^\nu(\slashed{p}_4+m)\gamma_\nu(\slashed{q}_1+m)\gamma_\mu
\right)
\\
f_{12}&=\sum_{a=1}^2\sum_{b=1}^2\mathcal M_{1ba}\mathcal M_{2ba}^*=e^4\operatorname{Tr}
\left(
(\slashed{p}_2+m)\gamma^\mu(\slashed{q}_2+m)\gamma^\nu(\slashed{p}_4+m)\gamma_\mu(\slashed{q}_1+m)\gamma_\nu
\right)
\\
f_{22}&=\sum_{a=1}^2\sum_{b=1}^2\mathcal M_{2ba}\mathcal M_{2ba}^*=e^4\operatorname{Tr}
\left(
(\slashed{p}_2+m)\gamma^\mu(\slashed{q}_2+m)\gamma^\nu(\slashed{p}_4+m)\gamma_\nu(\slashed{q}_2+m)\gamma_\mu
\right)
\end{align*}

Hence
\begin{equation*}
\langle|\mathcal{M}|^2\rangle
=
\frac{1}{4}
\left(
\frac{f_{11}}{(s-m^2)^2}
+\frac{f_{12}+f_{12}^*}{(s-m^2)(u-m^2)}
+\frac{f_{22}}{(u-m^2)^2}
\right)
\tag{1}
\end{equation*}

The following formulas are equivalent to the Casimir trick.
(Recall that $a\cdot b=a^\mu g_{\mu\nu}b^\nu$)
\begin{align*}
f_{11}&=e^4\left(
 32 (p_1 \cdot p_2) (p_1 \cdot p_4) +
 64 m^2 (p_1 \cdot p_2) -
 32 m^2 (p_1 \cdot p_3) -
 32 m^2 (p_1 \cdot p_4) + 32 m^4\right)
\\
f_{12}&=e^4\left(16 m^2 (p_1 \cdot p_2) - 16 m^2 (p_1 \cdot p_4) + 32m^4\right)
\\
f_{22}&=e^4\left(
32 (p_1 \cdot p_2) (p_1 \cdot p_4) +
32 m^2 (p_1 \cdot p_2) -
32 m^2 (p_1 \cdot p_3) -
64 m^2 (p_1 \cdot p_4) + 32 m^4\right)
\end{align*}

In Mandelstam variables
\begin{equation*}
\begin{aligned}
f_{11}&=e^4\left(-8 s u + 24 s m^2 + 8 u m^2 + 8 m^4\right)
\\
f_{12}&=e^4\left(8 s m^2 + 8 u m^2 + 16 m^4\right)
\\
f_{22}&=e^4\left(-8 s u + 8 s m^2 + 24 u m^2 + 8 m^4\right)
\end{aligned}
\tag{2}
\end{equation*}

Compton scattering experiments are typically done in the lab frame where the electron is at rest.
Define Lorentz boost $\Lambda$ for transforming momentum vectors to the lab frame.
\begin{equation*}
\Lambda=
\begin{pmatrix}
E/m & 0 & 0 & \omega/m\\
0 & 1 & 0 & 0\\
0 & 0 & 1 & 0\\
\omega/m & 0 & 0 & E/m
\end{pmatrix}
\end{equation*}

The electron is at rest in the lab frame.
\begin{equation*}
\Lambda p_2=\begin{pmatrix}m\\0\\0\\0\end{pmatrix}
\end{equation*}

Mandelstam variables are invariant under a boost.
\begin{equation*}
\begin{aligned}
s&=(p_1+p_2)^2=(\Lambda p_1+\Lambda p_2)^2
\\
t&=(p_1-p_3)^2=(\Lambda p_1-\Lambda p_3)^2
\\
u&=(p_1-p_4)^2=(\Lambda p_1-\Lambda p_4)^2
\end{aligned}
\end{equation*}

In the lab frame, let $\omega_L$ be the angular frequency of the incident photon
and let $\omega_L'$ be the angular frequency of the scattered photon.
\begin{equation*}
\begin{aligned}
\omega_L&=\Lambda p_1\cdot
\begin{pmatrix}1\\0\\0\\0\end{pmatrix}
=\frac{\omega^2}{m}+\frac{\omega E}{m}
\\[1ex]
\omega_L'&=\Lambda p_3\cdot
\begin{pmatrix}1\\0\\0\\0\end{pmatrix}
=\frac{\omega^2\cos\theta}{m}+\frac{\omega E}{m}
\end{aligned}
\end{equation*}

It can be shown that
\begin{equation*}
\begin{aligned}
s&=m^2+2m\omega_L
\\
t&=2m(\omega_L' - \omega_L)
\\
u&=m^2-2 m \omega_L'
\end{aligned}
\tag{3}
\end{equation*}

Then by (1), (2), and (3) we have
\begin{equation*}
\langle|\mathcal{M}|^2\rangle=
2e^4\left(
\frac{\omega_L}{\omega_L'}+\frac{\omega_L'}{\omega_L}
+\left(\frac{m}{\omega_L}-\frac{m}{\omega_L'}+1\right)^2-1
\right)
\end{equation*}

Lab scattering angle $\theta_L$ is given by the Compton equation
\begin{equation*}
\cos\theta_L=\frac{m}{\omega_L}-\frac{m}{\omega_L'}+1
\end{equation*}

Hence
\begin{align*}
\langle|\mathcal{M}|^2\rangle
&=2e^4\left(
\frac{\omega_L}{\omega_L'}+\frac{\omega_L'}{\omega_L}+\cos^2\theta_L-1
\right)
\\
&=2e^4\left(
\frac{\omega_L}{\omega_L'}+\frac{\omega_L'}{\omega_L}-\sin^2\theta_L
\right)
\end{align*}

\subsubsection*{Cross section}
Now that we have derived $\langle|\mathcal{M}|^2\rangle$
we can investigate the angular distribution of scattered photons.
For simplicity let us drop the $L$ subscript from lab variables.
From now on the symbols $\omega$, $\omega'$, and $\theta$ will be lab frame variables.

\bigskip
The differential cross section is
\begin{equation*}
\frac{d\sigma}{d\Omega}=\frac{1}{4(4\pi\varepsilon_0)^2s}
\left(\frac{\omega'}{\omega}\right)^2\langle|\mathcal{M}|^2\rangle
\end{equation*}

where
\begin{equation*}
s=m^2+2m\omega=(mc^2)^2+2(mc^2)(\hbar\omega)
\end{equation*}

and $\omega'$ is given by the Compton equation
\begin{equation*}
\omega'=\frac{\omega}{1+\frac{\hbar\omega}{mc^2}(1-\cos\theta)}
\end{equation*}

For the lab frame we have
\begin{equation*}
\langle|\mathcal{M}|^2\rangle
=2e^4\left(
\frac{\omega}{\omega'}+\frac{\omega'}{\omega}-\sin^2\theta
\right)
\end{equation*}

Hence in the lab frame
\begin{equation*}
\frac{d\sigma}{d\Omega}
=\frac{e^4}{2(4\pi\varepsilon_0)^2s}
\left(\frac{\omega'}{\omega}\right)^2
\left(
\frac{\omega}{\omega'}+\frac{\omega'}{\omega}-\sin^2\theta
\right)
\end{equation*}

Noting that
\begin{equation*}
e^2=4\pi\varepsilon_0\alpha\hbar c
\end{equation*}

we have
\begin{equation*}
\frac{d\sigma}{d\Omega}
=\frac{\alpha^2(\hbar c)^2}{2s}
\left(\frac{\omega'}{\omega}\right)^2
\left(
\frac{\omega}{\omega'}+\frac{\omega'}{\omega}-\sin^2\theta
\right)
\end{equation*}

Noting that
\begin{equation*}
d\Omega=\sin\theta\,d\theta\,d\phi
\end{equation*}

we also have
\begin{equation*}
d\sigma
=\frac{\alpha^2(\hbar c)^2}{2s}
\left(\frac{\omega'}{\omega}\right)^2
\left(
\frac{\omega}{\omega'}+\frac{\omega'}{\omega}-\sin^2\theta
\right)
\sin\theta\,d\theta\,d\phi
\end{equation*}

Let $S(\theta_1,\theta_2)$ be the following surface integral of $d\sigma$.
\begin{equation*}
S(\theta_1,\theta_2)=\int_0^{2\pi}\int_{\theta_1}^{\theta_2}d\sigma
\end{equation*}

The solution is
\begin{equation*}
S(\theta_1,\theta_2)=\frac{2\pi\alpha^2(\hbar c)^2}{2s}\bigl(I(\theta_2)-I(\theta_1)\bigr)
\end{equation*}

where
\begin{multline*}
I(\theta)=-\frac{\cos\theta}{R^2}
+\log\bigl(1+R(1-\cos\theta)\bigr)\left(\frac{1}{R}-\frac{2}{R^2}-\frac{2}{R^3}\right)
\\
{}-\frac{1}{2R\bigl(1+R(1-\cos\theta)\bigr)^2}
+\frac{1}{1+R(1-\cos\theta)}\left(-\frac{2}{R^2}-\frac{1}{R^3}\right)
\end{multline*}

and
\begin{equation*}
R=\frac{\hbar\omega}{mc^2}
\end{equation*}

The cumulative distribution function is
\begin{equation*}
F(\theta)
=\frac{S(0,\theta)}{S(0,\pi)}
=\frac{I(\theta)-I(0)}{I(\pi)-I(0)},
\quad
0\le\theta\le\pi
\end{equation*}

The probability of observing scattering events in the interval $\theta_1$ to $\theta_2$ is
\begin{equation*}
P(\theta_1\le\theta\le\theta_2)=F(\theta_2)-F(\theta_1)
\end{equation*}

Let $N$ be the total number of scattering events from an experiment.
Then the number of scattering events in the interval $\theta_1$
to $\theta_2$ is predicted to be
\begin{equation*}
NP(\theta_1\le\theta\le\theta_2)
\end{equation*}

The probability density function is
\begin{equation*}
f(\theta)=\frac{dF(\theta)}{d\theta}
=\frac{1}{I(\pi)-I(0)}
\left(\frac{\omega'}{\omega}\right)^2
\left(\frac{\omega}{\omega'}+\frac{\omega'}{\omega}-\sin^2\theta\right)
\sin\theta
\end{equation*}

\subsubsection*{Thomson scattering}
For $\hbar\omega\ll mc^2$ we have
\begin{equation*}
\omega'=\frac{\omega}{1+\frac{\hbar\omega}{mc^2}\,(1-\cos\theta)}\approx\omega
\end{equation*}

Hence we can use the approximations
\begin{equation*}
\omega=\omega'\quad\text{and}\quad s=(mc^2)^2
\end{equation*}

to obtain
\begin{equation*}
\frac{d\sigma}{d\Omega}=\frac{\alpha^2\hbar^2}{2m^2c^2}\left(1+\cos^2\theta\right)
\end{equation*}

which is the formula for Thomson scattering.

\subsubsection*{High energy approximation}
For $\omega\gg m$ a useful approximation is to set $m=0$ and obtain
\begin{align*}
f_{11}&=e^4(-8su)
\\
f_{12}&=0
\\
f_{22}&=e^4(-8su)
\end{align*}

Hence
\begin{align*}
\langle|\mathcal{M}|^2\rangle
&=\frac{e^4}{4}
\left(\frac{-8su}{s^2}+\frac{-8su}{u^2}\right)
\\
&=2e^4
\left(-\frac{u}{s}-\frac{s}{u}\right)
\end{align*}

Also for $m=0$ the Mandelstam variables $s$ and $u$ are
\begin{align*}
s&=4\omega^2
\\
u&=-2\omega^2(\cos\theta+1)
\end{align*}

Hence
\begin{equation*}
\langle|\mathcal{M}|^2\rangle
=2e^4\left(
\frac{\cos\theta+1}{2}+\frac{2}{\cos\theta+1}
\right)
\end{equation*}

\iffalse

\subsubsection*{Data from a CERN LEP experiment}
See ``Compton Scattering of Quasi-Real Virtual Photons at LEP,''
arxiv.org/abs/hep-ex/0504012.

\begin{center}
\begin{tabular}{|c|c|}
\hline
$x$ & $y$\\
\hline
$-0.74$ & $13380$\\
$-0.60$ & $\phantom{0}7720$\\
$-0.47$ & $\phantom{0}6360$\\
$-0.34$ & $\phantom{0}4600$\\
$-0.20$ & $\phantom{0}4310$\\
$-0.07$ & $\phantom{0}3700$\\
$\phantom{+}0.06$ & $\phantom{0}3640$\\
$\phantom{+}0.20$ & $\phantom{0}3340$\\
$\phantom{+}0.33$ & $\phantom{0}3500$\\
$\phantom{+}0.46$ & $\phantom{0}3010$\\
$\phantom{+}0.60$ & $\phantom{0}3310$\\
$\phantom{+}0.73$ & $\phantom{0}3330$\\
\hline
\end{tabular}
\end{center}

The data are for the center of mass frame and have the following relationship with the differential cross section formula.
\begin{equation*}
x=\cos\theta,
\quad
y=\frac{d\sigma}{d\cos\theta}=2\pi\frac{d\sigma}{d\Omega}
\end{equation*}

For the high energy approximation we have
\begin{equation*}
\langle|\mathcal{M}|^2\rangle
=
2e^4\left(
\frac{\cos\theta+1}{2}+\frac{2}{\cos\theta+1}
\right)
\end{equation*}

The corresponding cross section formula is
\begin{equation*}
\frac{d\sigma}{d\Omega}
=\frac{\langle|\mathcal{M}|^2\rangle}{64\pi^2s}
=\frac{e^4}{32\pi^2s}
\left(
\frac{\cos\theta+1}{2}+\frac{2}{\cos\theta+1}
\right),\quad s\gg m
\end{equation*}

Substituting $e^4=16\pi^2\alpha^2$ yields
\begin{equation*}
\frac{d\sigma}{d\Omega}
=\frac{\alpha^2}{2s}
\left(
\frac{\cos\theta+1}{2}+\frac{2}{\cos\theta+1}
\right)
\end{equation*}

Multiply by $2\pi$ to obtain
\begin{equation*}
\frac{d\sigma}{d\cos\theta}
=\frac{\pi\alpha^2}{s}\left(
\frac{\cos\theta+1}{2}+\frac{2}{\cos\theta+1}
\right)
\end{equation*}

To compute predicted values $\hat{y}$ from the above formula,
multiply by $(hc)^2$ to convert to SI
and multiply by $10^{40}$ to convert square meters to picobarns.
\begin{equation*}
\hat{y}
=
\frac{\pi\alpha^2}{s}
\left(
\frac{x+1}{2}+
\frac{2}{x+1}
\right)
\times(hc)^2
\times10^{40}
\end{equation*}

The following table shows $\hat{y}$
for $s=(40\,\text{GeV})^2$.

\begin{center}
\begin{tabular}{|c|c|c|}
\hline
$x$ & $y$ & $\hat{y}$\\
\hline
$-0.74$ & $13380$ & $12573$\\
$-0.60$ & $\phantom{0}7720$ & $\phantom{0}8358$\\
$-0.47$ & $\phantom{0}6360$ & $\phantom{0}6491$\\
$-0.34$ & $\phantom{0}4600$ & $\phantom{0}5401$\\
$-0.20$ & $\phantom{0}4310$ & $\phantom{0}4661$\\
$-0.07$ & $\phantom{0}3700$ & $\phantom{0}4204$\\
$\phantom{+}0.06$ & $\phantom{0}3640$ & $\phantom{0}3884$\\
$\phantom{+}0.20$ & $\phantom{0}3340$ & $\phantom{0}3643$\\
$\phantom{+}0.33$ & $\phantom{0}3500$ & $\phantom{0}3486$\\
$\phantom{+}0.46$ & $\phantom{0}3010$ & $\phantom{0}3375$\\
$\phantom{+}0.60$ & $\phantom{0}3310$ & $\phantom{0}3295$\\
$\phantom{+}0.73$ & $\phantom{0}3330$ & $\phantom{0}3248$\\
\hline
\end{tabular}
\end{center}

The coefficient of determination $R^2$ measures how well predicted values fit the data.
\begin{equation*}
R^2=1-\frac{\sum(y-\hat{y})^2}{\sum(y-\bar{y})^2}=0.97
\end{equation*}

The result indicates that the model $d\sigma$ explains 97\% of the variance in the data.

\fi

\iffalse
\subsubsection*{Notes}
Here are a few notes regarding the Eigenmath scripts.

\bigskip
Start by writing out $a_1$ and $a_2$ in full component form.
\begin{equation*}
a_1^{\mu\nu}
=\bar{u}_{4\alpha}\gamma^{\mu\alpha}{}_\beta(\slashed{q}_1+m)^\beta{}_\rho\gamma^{\nu\rho}{}_\sigma u_2^\sigma,
\quad
a_2^{\nu\mu}
=\bar{u}_{4\alpha}\gamma^{\nu\alpha}{}_\beta(\slashed{q}_2+m)^\beta{}_\rho\gamma^{\mu\rho}{}_\sigma u_2^\sigma
\end{equation*}

Transpose $\gamma$ tensors to form inner products over $\alpha$ and $\rho$.
\begin{equation*}
a_1^{\mu\nu}
=\bar{u}_{4\alpha}\gamma^{\alpha\mu}{}_\beta(\slashed{q}_1+m)^\beta{}_\rho\gamma^{\rho\nu}{}_\sigma u_2^\sigma,
\quad
a_2^{\nu\mu}
=\bar{u}_{4\alpha}\gamma^{\alpha\nu}{}_\beta(\slashed{q}_2+m)^\beta{}_\rho\gamma^{\rho\mu}{}_\sigma u_2^\sigma
\end{equation*}

Convert transposed $\gamma$ to Eigenmath code.
\begin{equation*}
\gamma^{\alpha\mu}{}_\beta
\quad\rightarrow\quad
\text{\tt gammaT = transpose(gamma)}
\end{equation*}

Then to compute $a_1$ we have
\begin{multline*}
a_1=\bar{u}_{4\alpha}\gamma^{\alpha\mu}{}_\beta(\slashed{q}_1+m)^\beta{}_\rho\gamma^{\rho\nu}{}_\sigma u_2^\sigma
\\
\rightarrow\quad
\text{\tt a1 = dot(u4bar[s4],gammaT,qslash1 + m I,gammaT,u2[s2])}
\end{multline*}

where $s_2$ and $s_4$ are spin indices.
Similarly for $a_2$ we have
\begin{multline*}
a_2=\bar{u}_{4\alpha}\gamma^{\alpha\nu}{}_\beta(\slashed{q}_2+m)^\beta{}_\rho\gamma^{\rho\mu}{}_\sigma u_2^\sigma
\\
\rightarrow\quad
\text{\tt a2 = dot(u4bar[s4],gammaT,qslash2 + m I,gammaT,u2[s2])}
\end{multline*}

In component notation the product $a_1a_1^*$ is
\begin{equation*}
a_1a_1^*=a_1^{\mu\nu}a_1^{*\mu\nu}
\end{equation*}

To sum over $\mu$ and $\nu$ it is necessary to lower indices with the metric tensor.
Also, transpose $a_1^*$ to form an inner product with $\nu$.
\begin{equation*}
a_1a_1^*=a_1^{\mu\nu}a_{1\nu\mu}^*
\end{equation*}

Convert to Eigenmath code.
The dot function sums over $\nu$ and the contract function sums over $\mu$.
\begin{equation*}
a_1a_1^*
\quad\rightarrow\quad
\text{\tt a11 = contract(dot(a1,gmunu,transpose(conj(a1)),gmunu))}
\end{equation*}

Similarly for $a_2a_2^*$ we have
\begin{equation*}
a_2a_2^*
\quad\rightarrow\quad
\text{\tt a22 = contract(dot(a2,gmunu,transpose(conj(a2)),gmunu))}
\end{equation*}

The product $a_1a_2^*$ does not require a transpose because $a_1a_2^*=a_1^{\mu\nu}a_2^{*\nu\mu}$.
\begin{equation*}
a_1a_2^*
\quad\rightarrow\quad
\text{\tt a12 = contract(dot(a1,gmunu,conj(a2),gmunu))}
\end{equation*}

In component notation, a trace operator becomes a sum over an index, in this case $\alpha$.
\begin{align*}
f_{11}
&=
\mathop{\rm Tr}
\left(
(\slashed{p}_2+m)\gamma^\mu(\slashed{q}_1+m)\gamma^\nu(\slashed{p}_4+m)\gamma_\nu(\slashed{q}_1+m)\gamma_\mu
\right)\\
&=
(\slashed{p}_2+m)^\alpha{}_\beta
\gamma^{\mu\beta}{}_\rho
(\slashed{q}_1+m)^\rho{}_\sigma
\gamma^{\nu\sigma}{}_\tau
(\slashed{p}_4+m)^\tau{}_\delta
\gamma_\nu{}^\delta{}_\eta
(\slashed{q}_1+m)^\eta{}_\xi
\gamma_\mu{}^\xi{}_\alpha
\end{align*}

As before, transpose $\gamma$ tensors to form inner products.
\begin{equation*}
f_{11}=
(\slashed{p}_2+m)^\alpha{}_\beta
\gamma^{\beta\mu}{}_\rho
(\slashed{q}_1+m)^\rho{}_\sigma
\gamma^{\sigma\nu}{}_\tau
(\slashed{p}_4+m)^\tau{}_\delta
\gamma^\delta{}_{\nu\eta}
(\slashed{q}_1+m)^\eta{}_\xi
\gamma^\xi{}_{\mu\alpha}
\end{equation*}

To convert to Eigenmath code, use an intermediate variable for the inner product.
\begin{equation*}
T^{\alpha\mu\nu}{}_{\nu\mu\alpha}
\quad\rightarrow\quad
\text{\tt T = dot(P2,gammaT,Q1,gammaT,P4,gammaL,Q1,gammaL)}
\end{equation*}

Now sum over the indices of $T$.
The innermost contract sums over $\nu$ then the next contract sums over $\mu$.
Finally the outermost contract sums over $\alpha$.
\begin{equation*}
f_{11}\quad\rightarrow\quad
\text{\tt f11 = contract(contract(contract(T,3,4),2,3))}
\end{equation*}

Follow suit for $f_{22}$.
For $f_{12}$ the order of the rightmost $\mu$ and $\nu$ is reversed.
\begin{equation*}
f_{12}=\mathop{\rm Tr}
\left(
(\slashed{p}_2+m)\gamma^\mu(\slashed{q}_2+m)\gamma^\nu(\slashed{p}_4+m)\gamma_\mu(\slashed{q}_1+m)\gamma_\nu
\right)
\end{equation*}

The resulting inner product is $T^{\alpha\mu\nu}{}_{\mu\nu\alpha}$
so the contraction is different.
\begin{equation*}
f_{12}
\quad\rightarrow\quad
\text{\tt f12 = contract(contract(contract(T,3,5),2,3))}
\end{equation*}

The innermost contract sums over $\nu$ followed by sum over $\mu$ then sum over $\alpha$.
\fi

\end{document}
